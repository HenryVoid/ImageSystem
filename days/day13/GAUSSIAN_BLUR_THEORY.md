# Gaussian Blur ì´ë¡ 

> Gaussian Blurì˜ ìˆ˜í•™ì  ì›ë¦¬ì™€ íš¨ìœ¨ì ì¸ êµ¬í˜„ ë°©ë²•ì„ ìƒì„¸íˆ ë‹¤ë£¹ë‹ˆë‹¤

---

## ğŸ“‹ ëª©ì°¨

1. [Blurë€?](#blurë€)
2. [Gaussian í•¨ìˆ˜](#gaussian-í•¨ìˆ˜)
3. [ì»¨ë³¼ë£¨ì…˜ ì—°ì‚°](#ì»¨ë³¼ë£¨ì…˜-ì—°ì‚°)
4. [2-Pass ìµœì í™”](#2-pass-ìµœì í™”)
5. [êµ¬í˜„ ìƒì„¸](#êµ¬í˜„-ìƒì„¸)
6. [ì„±ëŠ¥ ë¶„ì„](#ì„±ëŠ¥-ë¶„ì„)

---

## Blurë€?

### ì •ì˜

**Blur(ë¸”ëŸ¬)**ëŠ” ì´ë¯¸ì§€ë¥¼ íë¦¿í•˜ê²Œ ë§Œë“œëŠ” íš¨ê³¼ì…ë‹ˆë‹¤.

### ì¢…ë¥˜

| ì¢…ë¥˜ | íŠ¹ì§• | ìš©ë„ |
|------|------|------|
| **Box Blur** | ë‹¨ìˆœ í‰ê· , ë¹ ë¦„ | ê°„ë‹¨í•œ ë¸”ëŸ¬ |
| **Gaussian Blur** | ìì—°ìŠ¤ëŸ¬ì›€, ì¤‘ê°„ ì†ë„ | ì¼ë°˜ì  ë¸”ëŸ¬ |
| **Motion Blur** | ë°©í–¥ì„±, ì¤‘ê°„ ì†ë„ | ì›€ì§ì„ í‘œí˜„ |
| **Radial Blur** | ì¤‘ì‹¬ ë°©í–¥, ëŠë¦¼ | ì†ë„ê° í‘œí˜„ |

### ì‹œê°ì  íš¨ê³¼

```
ì›ë³¸:
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

Box Blur (r=1):
â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“

Gaussian Blur (r=1):
â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“
â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’
â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
```

---

## Gaussian í•¨ìˆ˜

### 1D Gaussian í•¨ìˆ˜

**ìˆ˜ì‹**:
```
G(x) = (1 / âˆš(2Ï€ÏƒÂ²)) Ã— e^(âˆ’xÂ² / (2ÏƒÂ²))
```

**ë³€ìˆ˜**:
- `x`: ì¤‘ì‹¬ìœ¼ë¡œë¶€í„°ì˜ ê±°ë¦¬
- `Ïƒ` (sigma): í‘œì¤€ í¸ì°¨ (ë¸”ëŸ¬ ê°•ë„)
- `Ï€` (pi): ì›ì£¼ìœ¨ (3.14159...)
- `e`: ìì—°ë¡œê·¸ì˜ ë°‘ (2.71828...)

### ê·¸ë˜í”„

```
Ïƒ = 1.0:

  1.0 |     *
      |    ***
  0.5 |   *****
      |  *******
  0.0 |_*********_
      -3  -1  0  1  3  (x)

ë„“ì€ Ïƒ (Ïƒ = 2.0):
  1.0 |      *
      |     ***
  0.5 |   *******
      |  *********
  0.0 |_***********_
      -5  -2  0  2  5  (x)
```

### íŠ¹ì§•

- **ì¤‘ì‹¬ì—ì„œ ìµœëŒ€ê°’**: G(0)ì´ ê°€ì¥ í¼
- **ëŒ€ì¹­**: G(x) = G(-x)
- **ë¹ ë¥¸ ê°ì†Œ**: ê±°ë¦¬ ì¦ê°€ â†’ ê°’ ê¸‰ê²©íˆ ê°ì†Œ
- **ì •ê·œí™”**: âˆ«G(x)dx = 1 (ì „ì²´ ë©´ì  = 1)

### Ïƒì™€ ë°˜ê²½ì˜ ê´€ê³„

```
ì¼ë°˜ì ì¸ ê·œì¹™:
radius = 3Ïƒ

Ïƒ = 1.0 â†’ radius = 3
Ïƒ = 2.0 â†’ radius = 6
Ïƒ = 3.0 â†’ radius = 9

3Ïƒ ë°–ì˜ ê°’ì€ ë¬´ì‹œí•´ë„ ë¨ (< 0.3%)
```

---

## ì»¨ë³¼ë£¨ì…˜ ì—°ì‚°

### ì •ì˜

**ì»¨ë³¼ë£¨ì…˜(Convolution)**ì€ ì»¤ë„ì„ ì´ë¯¸ì§€ ìœ„ì— ìŠ¬ë¼ì´ë”©í•˜ë©° ì ìš©í•˜ëŠ” ì—°ì‚°ì…ë‹ˆë‹¤.

### ìˆ˜ì‹

```
I'(x, y) = Î£ Î£ I(x+i, y+j) Ã— K(i, j)
           i j
```

- `I'`: ì¶œë ¥ ì´ë¯¸ì§€
- `I`: ì…ë ¥ ì´ë¯¸ì§€
- `K`: ì»¤ë„ (ê°€ì¤‘ì¹˜)

### ì‹œê°í™”

```
3Ã—3 Gaussian ì»¤ë„ ì˜ˆì‹œ:

K = | 1  2  1 |
    | 2  4  2 | Ã— (1/16)
    | 1  2  1 |

ì…ë ¥ ì´ë¯¸ì§€ ì˜ì—­:
| 10  20  30 |
| 40  50  60 |
| 70  80  90 |

ì¶œë ¥ í”½ì…€ ê³„ì‚°:
(10Ã—1 + 20Ã—2 + 30Ã—1 +
 40Ã—2 + 50Ã—4 + 60Ã—2 +
 70Ã—1 + 80Ã—2 + 90Ã—1) / 16
= 50 (ì¤‘ì•™ê°’)
```

### 1D Gaussian ì»¤ë„ ì˜ˆì‹œ

**ë°˜ê²½ 2, Ïƒ=1.0**:
```
ìœ„ì¹˜:  -2    -1     0     1     2
ê°€ì¤‘ì¹˜: 0.05  0.24  0.40  0.24  0.05
(ì •ê·œí™”ë¨, í•© = 1.0)
```

### 2D Gaussian ì»¤ë„

**2D ë²„ì „ (5Ã—5)**:
```
     -2    -1     0     1     2
-2 | 0.00  0.01  0.02  0.01  0.00
-1 | 0.01  0.06  0.10  0.06  0.01
 0 | 0.02  0.10  0.16  0.10  0.02
 1 | 0.01  0.06  0.10  0.06  0.01
 2 | 0.00  0.01  0.02  0.01  0.00
```

**ë¬¸ì œì **: 2D ì»¤ë„ì€ ê³„ì‚°ëŸ‰ì´ ë§ìŒ!
- 5Ã—5 ì»¤ë„ = í”½ì…€ë‹¹ 25ë²ˆ ê³±ì…ˆ
- 11Ã—11 ì»¤ë„ = í”½ì…€ë‹¹ 121ë²ˆ ê³±ì…ˆ

---

## 2-Pass ìµœì í™”

### í•µì‹¬ ì•„ì´ë””ì–´

**Gaussianì€ ë¶„ë¦¬ ê°€ëŠ¥(Separable)**í•©ë‹ˆë‹¤!

```
Gâ‚‚D(x, y) = Gâ‚D(x) Ã— Gâ‚D(y)
```

ì¦‰, 2D Gaussian = 1D Gaussian (ìˆ˜í‰) Ã— 1D Gaussian (ìˆ˜ì§)

### ì•Œê³ ë¦¬ì¦˜

```
1st Pass: ìˆ˜í‰ ë¸”ëŸ¬
  ì…ë ¥: ì›ë³¸ ì´ë¯¸ì§€
  ì¶œë ¥: ì¤‘ê°„ ì´ë¯¸ì§€
  ê° í”½ì…€ (x, y):
    ì¤‘ê°„[x, y] = Î£ ì›ë³¸[x+i, y] Ã— G(i)
                  i

2nd Pass: ìˆ˜ì§ ë¸”ëŸ¬
  ì…ë ¥: ì¤‘ê°„ ì´ë¯¸ì§€
  ì¶œë ¥: ìµœì¢… ì´ë¯¸ì§€
  ê° í”½ì…€ (x, y):
    ìµœì¢…[x, y] = Î£ ì¤‘ê°„[x, y+j] Ã— G(j)
                  j
```

### ë³µì¡ë„ ë¹„êµ

**2D ë°©ì‹**:
```
ì»¤ë„ í¬ê¸°: (2r+1) Ã— (2r+1)
í”½ì…€ë‹¹ ì—°ì‚°: (2r+1)Â² = 4rÂ² + 4r + 1

r=5:  121ë²ˆ
r=10: 441ë²ˆ
r=20: 1,681ë²ˆ
```

**2-Pass ë°©ì‹**:
```
1st Pass: (2r+1)ë²ˆ
2nd Pass: (2r+1)ë²ˆ
ì´: 2(2r+1) = 4r + 2

r=5:  22ë²ˆ (5.5ë°° ë¹ ë¦„!)
r=10: 42ë²ˆ (10.5ë°° ë¹ ë¦„!)
r=20: 82ë²ˆ (20.5ë°° ë¹ ë¦„!)
```

### ì‹œê°í™”

```
2D ë°©ì‹ (9Ã—9 ì»¤ë„):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ * * * * â”‚  81ë²ˆ ê³„ì‚°
â”‚ * * * * â”‚
â”‚ * * * * â”‚
â”‚ * * * * â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2-Pass ë°©ì‹:
1st: â”€ â”€ â”€ â”€ â”€  9ë²ˆ ê³„ì‚°
2nd: â”‚
     â”‚
     â”‚
     â”‚
     â”‚
     â”‚
     â”‚
     â”‚             9ë²ˆ ê³„ì‚°
                  â”€â”€â”€â”€â”€â”€â”€â”€
                  ì´ 18ë²ˆ (4.5ë°° ë¹ ë¦„!)
```

---

## êµ¬í˜„ ìƒì„¸

### 1. ê°€ì¤‘ì¹˜ ê³„ì‚°

**Swift ì½”ë“œ**:
```swift
func createGaussianWeights(radius: Int, sigma: Float) -> [Float] {
    let kernelSize = 2 * radius + 1
    var weights = [Float](repeating: 0, count: kernelSize)
    var sum: Float = 0
    
    // Gaussian ê°’ ê³„ì‚°
    for i in 0..<kernelSize {
        let x = Float(i - radius)
        let weight = exp(-(x * x) / (2.0 * sigma * sigma))
        weights[i] = weight
        sum += weight
    }
    
    // ì •ê·œí™” (í•© = 1.0)
    for i in 0..<kernelSize {
        weights[i] /= sum
    }
    
    return weights
}
```

**ì˜ˆì‹œ ì¶œë ¥** (radius=3, sigma=1.0):
```
[-3]: 0.0044
[-2]: 0.0540
[-1]: 0.2420
[ 0]: 0.3989  â† ì¤‘ì‹¬ (ìµœëŒ€)
[ 1]: 0.2420
[ 2]: 0.0540
[ 3]: 0.0044
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
í•©ê³„: 1.0000
```

### 2. ìˆ˜í‰ ë¸”ëŸ¬ (Metal Shader)

```metal
kernel void gaussianBlurHorizontal(
    texture2d<float, access::read> input [[texture(0)]],
    texture2d<float, access::write> output [[texture(1)]],
    constant float *weights [[buffer(0)]],
    constant int &radius [[buffer(1)]],
    uint2 gid [[thread_position_in_grid]]
)
{
    // ë²”ìœ„ ì²´í¬
    if (gid.x >= output.get_width() || gid.y >= output.get_height()) {
        return;
    }
    
    float4 sum = float4(0.0);
    
    // ìˆ˜í‰ ë°©í–¥ìœ¼ë¡œ ì»¨ë³¼ë£¨ì…˜
    for (int i = -radius; i <= radius; i++) {
        // ê²½ê³„ ì²˜ë¦¬: Clamp
        int x = clamp(int(gid.x) + i, 0, int(input.get_width()) - 1);
        
        // í”½ì…€ ì½ê¸°
        float4 pixel = input.read(uint2(x, gid.y));
        
        // ê°€ì¤‘ì¹˜ ê³±í•˜ê¸°
        float weight = weights[i + radius];
        sum += pixel * weight;
    }
    
    // ê²°ê³¼ ì“°ê¸°
    output.write(sum, gid);
}
```

### 3. ìˆ˜ì§ ë¸”ëŸ¬ (Metal Shader)

```metal
kernel void gaussianBlurVertical(
    texture2d<float, access::read> input [[texture(0)]],
    texture2d<float, access::write> output [[texture(1)]],
    constant float *weights [[buffer(0)]],
    constant int &radius [[buffer(1)]],
    uint2 gid [[thread_position_in_grid]]
)
{
    if (gid.x >= output.get_width() || gid.y >= output.get_height()) {
        return;
    }
    
    float4 sum = float4(0.0);
    
    // ìˆ˜ì§ ë°©í–¥ìœ¼ë¡œ ì»¨ë³¼ë£¨ì…˜
    for (int i = -radius; i <= radius; i++) {
        // ê²½ê³„ ì²˜ë¦¬: Clamp
        int y = clamp(int(gid.y) + i, 0, int(input.get_height()) - 1);
        
        // í”½ì…€ ì½ê¸°
        float4 pixel = input.read(uint2(gid.x, y));
        
        // ê°€ì¤‘ì¹˜ ê³±í•˜ê¸°
        float weight = weights[i + radius];
        sum += pixel * weight;
    }
    
    output.write(sum, gid);
}
```

### 4. ê²½ê³„ ì²˜ë¦¬ ë°©ë²•

**Clamp (ìš°ë¦¬ê°€ ì‚¬ìš©í•˜ëŠ” ë°©ë²•)**:
```
ì´ë¯¸ì§€ ê²½ê³„ë¥¼ ë„˜ì–´ê°€ë©´ ê°€ì¥ìë¦¬ í”½ì…€ ë°˜ë³µ

[A B C D]
 â†‘     â†‘
-1 â†’ A (í´ë¨í”„)
 4 â†’ D (í´ë¨í”„)
```

**Wrap**:
```
ì´ë¯¸ì§€ë¥¼ ë°˜ë³µ

[A B C D]
-1 â†’ D (ìˆœí™˜)
 4 â†’ A (ìˆœí™˜)
```

**Mirror**:
```
ì´ë¯¸ì§€ë¥¼ ê±°ìš¸ì²˜ëŸ¼ ë°˜ì‚¬

[A B C D]
-1 â†’ B (ë°˜ì‚¬)
-2 â†’ C (ë°˜ì‚¬)
```

**Zero**:
```
ê²½ê³„ ë°–ì€ 0 (ê²€ì •)

[A B C D]
-1 â†’ 0
 4 â†’ 0
```

---

## ì„±ëŠ¥ ë¶„ì„

### ì´ë¡ ì  ê³„ì‚°ëŸ‰

**1024Ã—768 ì´ë¯¸ì§€, ë°˜ê²½ 10**:

```
2D ë°©ì‹:
  í”½ì…€ë‹¹: 21Â² = 441ë²ˆ ê³±ì…ˆ
  ì „ì²´: 1024 Ã— 768 Ã— 441 = 347,127,808ë²ˆ

2-Pass ë°©ì‹:
  1st Pass: 1024 Ã— 768 Ã— 21 = 16,515,072ë²ˆ
  2nd Pass: 1024 Ã— 768 Ã— 21 = 16,515,072ë²ˆ
  ì „ì²´: 33,030,144ë²ˆ

ì†ë„ í–¥ìƒ: 347,127,808 / 33,030,144 = 10.5ë°°!
```

### ì‹¤ì¸¡ ì„±ëŠ¥ (Metal)

**iPhone ì‹œë®¬ë ˆì´í„° (M1 Mac)**:

| ì´ë¯¸ì§€ í¬ê¸° | ë°˜ê²½ | ì²˜ë¦¬ ì‹œê°„ |
|-------------|------|-----------|
| 500Ã—500 | 5 | 3 ms |
| 500Ã—500 | 10 | 5 ms |
| 500Ã—500 | 20 | 12 ms |
| 1000Ã—1000 | 5 | 8 ms |
| 1000Ã—1000 | 10 | 15 ms |
| 1000Ã—1000 | 20 | 40 ms |
| 2000Ã—2000 | 5 | 30 ms |
| 2000Ã—2000 | 10 | 60 ms |
| 2000Ã—2000 | 20 | 150 ms |

**ê´€ì°°**:
- í”½ì…€ ìˆ˜ 4ë°° â†’ ì‹œê°„ ì•½ 4ë°° (ì„ í˜•)
- ë°˜ê²½ 2ë°° â†’ ì‹œê°„ ì•½ 2ë°° (ì„ í˜•)
- O(pixels Ã— radius)

### GPU ë³‘ë ¬ ì²˜ë¦¬

**ìˆœì°¨ ì²˜ë¦¬ (CPU)**:
```
í”½ì…€ ì²˜ë¦¬ ìˆœì„œ:
í”½ì…€ 0 â†’ í”½ì…€ 1 â†’ í”½ì…€ 2 â†’ ... â†’ í”½ì…€ N
â”‚      â”‚      â”‚              â”‚
â–¼      â–¼      â–¼              â–¼
ì‹œê°„ â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’
```

**ë³‘ë ¬ ì²˜ë¦¬ (GPU)**:
```
ëª¨ë“  í”½ì…€ ë™ì‹œ ì²˜ë¦¬:
í”½ì…€ 0 â”
í”½ì…€ 1 â”œâ”€ ë™ì‹œ ì‹¤í–‰
í”½ì…€ 2 â”¤
  ...  â”‚
í”½ì…€ N â”˜
â”‚
â–¼
ì‹œê°„ â†’
```

**íš¨ê³¼**:
- 786,432ê°œ í”½ì…€ (1024Ã—768)
- CPU: ìˆœì°¨ ì²˜ë¦¬ (ëŠë¦¼)
- GPU: ëª¨ë‘ ë™ì‹œ ì²˜ë¦¬ (ë¹ ë¦„!)

---

## ğŸ’¡ ì¶”ê°€ ìµœì í™”

### 1. Threadgroup Memory ì‚¬ìš©

```metal
kernel void blurOptimized(
    texture2d<float, access::read> input [[texture(0)]],
    texture2d<float, access::write> output [[texture(1)]],
    constant float *weights [[buffer(0)]],
    threadgroup float4 *shared [[threadgroup(0)]],  // ê³µìœ  ë©”ëª¨ë¦¬
    uint2 gid [[thread_position_in_grid]],
    uint2 tid [[thread_position_in_threadgroup]]
)
{
    // ê³µìœ  ë©”ëª¨ë¦¬ë¡œ ë¨¼ì € ë¡œë“œ (ë¹ ë¦„)
    shared[tid.y * 16 + tid.x] = input.read(gid);
    threadgroup_barrier(mem_flags::mem_threadgroup);
    
    // ê³µìœ  ë©”ëª¨ë¦¬ì—ì„œ ì½ê¸° (í…ìŠ¤ì²˜ë³´ë‹¤ í›¨ì”¬ ë¹ ë¦„)
    // ...
}
```

### 2. Linear Sampling

```metal
// í…ìŠ¤ì²˜ ìƒ˜í”ŒëŸ¬ ì‚¬ìš© (í•˜ë“œì›¨ì–´ ë³´ê°„)
constexpr sampler s(address::clamp_to_edge, filter::linear);
float4 pixel = input.sample(s, float2(x, y));
```

### 3. Box Blur ê·¼ì‚¬

```
Gaussian â‰ˆ ì—¬ëŸ¬ ë²ˆì˜ Box Blur

3ë²ˆì˜ Box Blur â‰ˆ Gaussian Blur
ë” ë¹ ë¥´ì§€ë§Œ ëœ ì •í™•
```

---

## ğŸ”¬ ì‹¤í—˜

### ì‹¤í—˜ 1: Ïƒ ê°’ ë³€í™”

```swift
let image = loadImage()

// Ïƒê°€ ì‘ì„ìˆ˜ë¡ ì•½í•œ ë¸”ëŸ¬
blur(image, radius: 9, sigma: 1.0)  // ì•½í•œ ë¸”ëŸ¬
blur(image, radius: 9, sigma: 3.0)  // ê°•í•œ ë¸”ëŸ¬
blur(image, radius: 9, sigma: 5.0)  // ë§¤ìš° ê°•í•œ ë¸”ëŸ¬
```

### ì‹¤í—˜ 2: ë°˜ê²½ ë³€í™”

```swift
// ë°˜ê²½ì´ í´ìˆ˜ë¡ ë„“ì€ ì˜ì—­ì—ì„œ ìƒ˜í”Œë§
blur(image, radius: 3, sigma: 1.0)   // ì‘ì€ ë¸”ëŸ¬
blur(image, radius: 10, sigma: 3.3)  // ì¤‘ê°„ ë¸”ëŸ¬
blur(image, radius: 20, sigma: 6.7)  // í° ë¸”ëŸ¬
```

### ì‹¤í—˜ 3: ì—¬ëŸ¬ ë²ˆ ì ìš©

```swift
// ì•½í•œ ë¸”ëŸ¬ë¥¼ ì—¬ëŸ¬ ë²ˆ = ê°•í•œ ë¸”ëŸ¬
var result = image
for _ in 0..<5 {
    result = blur(result, radius: 3, sigma: 1.0)
}
// â‰ˆ blur(image, radius: 15, sigma: 5.0)
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

### ë…¼ë¬¸
- "Fast Gaussian Blur" by Ivan Kuckir
- "Efficient Gaussian Blur with Linear Sampling"

### ì›¹ ìë£Œ
- [Gaussian Blur - Wikipedia](https://en.wikipedia.org/wiki/Gaussian_blur)
- [Image Convolution Examples](http://setosa.io/ev/image-kernels/)

### Apple ë¬¸ì„œ
- [Metal Shading Language Specification](https://developer.apple.com/metal/Metal-Shading-Language-Specification.pdf)

---

**ë‹¤ìŒ**: [PERFORMANCE_COMPARISON.md](PERFORMANCE_COMPARISON.md) - Metal vs Core Image ì„±ëŠ¥ ë¹„êµ

