# Day 16 시작하기

> AVFoundation 카메라 세션 학습을 위한 빠른 시작 가이드

---

## 🎯 오늘의 학습 목표

카메라 권한 요청, 세션 구성, 미리보기 표시, 사진 캡처를 학습합니다.

---

## ⚡ 빠른 시작 (5분)

### 1단계: 프로젝트 열기
```bash
cd day16
open day16.xcodeproj
```

### 2단계: 권한 설정 확인

⚠️ **중요**: Info.plist에 권한 설명이 포함되어 있는지 확인하세요.

**필수 권한**:
- `NSCameraUsageDescription`: 카메라 접근 권한
- `NSPhotoLibraryAddUsageDescription`: 사진 저장 권한 (선택)

### 3단계: 앱 실행
```
⌘R (Run)
```

**중요**: **실제 기기에서만 테스트 가능합니다!** 시뮬레이터는 카메라를 사용할 수 없습니다.

---

## 📚 학습 순서

### 1️⃣ 이론 학습 (30분)

**AVFOUNDATION_THEORY.md** 읽기
- AVFoundation 기본 개념
- AVCaptureSession, AVCaptureDevice 구조
- 세션 구성 원리

**CAMERA_SESSION_GUIDE.md** 읽기
- 단계별 구현 가이드
- 권한 → 세션 → 프리뷰 → 캡처 플로우

**PERFORMANCE_GUIDE.md** 읽기
- 성능 측정 방법
- FPS 및 메모리 모니터링

### 2️⃣ 기본 실습 (40분)

**SimpleCameraView**
- 카메라 권한 요청
- 기본 미리보기 표시
- 세션 시작/중지

**CaptureView**
- 사진 캡처 기능
- 카메라 전환 (전면/후면)
- 촬영한 사진 표시 및 저장

### 3️⃣ 실전 응용 (30분)

**CameraFlowView**
- 전체 플로우 통합
- 성능 모니터 표시
- 실시간 FPS 및 메모리 측정

### 4️⃣ 가이드 읽기 (20분)
```
AVFOUNDATION_THEORY.md          - 이론 설명
CAMERA_SESSION_GUIDE.md         - 구현 가이드
PERFORMANCE_GUIDE.md            - 성능 측정
```

**총 학습 시간: 약 2시간**

---

## 🔑 핵심 코드

### 권한 확인 및 요청
```swift
// 권한 확인
let status = AVCaptureDevice.authorizationStatus(for: .video)

// 권한 요청
await AVCaptureDevice.requestAccess(for: .video)
```

### 세션 구성
```swift
let session = AVCaptureSession()
session.sessionPreset = .photo

// 장치 선택
let camera = AVCaptureDevice.default(.builtInWideAngleCamera, 
                                     for: .video, 
                                     position: .back)

// 입력 추가
let input = try AVCaptureDeviceInput(device: camera)
session.addInput(input)

// 출력 추가
let photoOutput = AVCapturePhotoOutput()
session.addOutput(photoOutput)

// 세션 시작
session.startRunning()
```

### 미리보기 표시
```swift
let previewLayer = AVCaptureVideoPreviewLayer(session: session)
previewLayer.videoGravity = .resizeAspectFill
previewLayer.frame = view.bounds
view.layer.addSublayer(previewLayer)
```

### 사진 캡처
```swift
let settings = AVCapturePhotoSettings()
photoOutput.capturePhoto(with: settings, delegate: self)

// AVCapturePhotoCaptureDelegate
func photoOutput(_ output: AVCapturePhotoOutput,
                 didFinishProcessingPhoto photo: AVCapturePhoto,
                 error: Error?) {
    guard let imageData = photo.fileDataRepresentation(),
          let image = UIImage(data: imageData) else { return }
    // 이미지 처리
}
```

---

## ⚠️ 주의사항

### 실제 기기 테스트 필수

시뮬레이터보다 **실제 기기**를 사용해야 합니다:

**이유**:
- ✅ 실제 카메라 하드웨어 접근
- ✅ 권한 시스템 정확한 테스트
- ✅ 성능 측정 정확도 향상

### 권한 설정

**필수**: Info.plist에 권한 설명 추가
```xml
<key>NSCameraUsageDescription</key>
<string>사진을 촬영하기 위해 카메라 접근이 필요합니다.</string>
```

### 세션 생명주기

```swift
// 뷰가 나타날 때
.onAppear {
    sessionManager.startSession()
}

// 뷰가 사라질 때
.onDisappear {
    sessionManager.stopSession()
}
```

---

## 🐛 문제 해결

### "카메라를 사용할 수 없습니다" 오류

**원인**: 시뮬레이터 사용 또는 권한 거부

**해결**:
1. 실제 기기에서 테스트
2. Info.plist에 권한 설명 확인
3. 설정 앱에서 권한 확인

### "세션이 시작되지 않습니다"

**원인**: 세션 설정 전에 `startRunning()` 호출

**해결**:
- `setupSession()` 완료 후 시작
- `sessionQueue`에서 순차적으로 처리

### "미리보기가 표시되지 않습니다"

**원인**: PreviewLayer 프레임 미설정

**해결**:
```swift
func updateUIView(_ uiView: UIView, context: Context) {
    if let previewLayer = uiView.layer.sublayers?.first as? AVCaptureVideoPreviewLayer {
        previewLayer.frame = uiView.bounds  // 프레임 업데이트
    }
}
```

---

## 📱 실제 기기 테스트

### 설정

1. iPhone을 Mac에 연결
2. Xcode에서 기기 선택
3. Signing & Capabilities 설정
4. ⌘R 실행

### 권한 테스트

1. 앱 실행 시 권한 요청 팝업 확인
2. "허용" 선택하여 권한 테스트
3. "거부" 선택하여 권한 거부 시나리오 테스트
4. 설정에서 권한 변경 후 앱 재시작하여 변경 감지 확인

---

## 🎓 학습 팁

### 효과적인 학습 방법

1. **이론 먼저**: AVFOUNDATION_THEORY.md 정독
2. **코드 실행**: 각 View를 직접 실행해보기
3. **코드 수정**: 값을 바꿔가며 실험
4. **실제 기기**: 실제 기기에서 테스트
5. **가이드 읽기**: CAMERA_SESSION_GUIDE.md, PERFORMANCE_GUIDE.md

### 실습 아이디어

- 📸 커스텀 카메라 UI 만들기
  - 촬영 버튼 디자인 변경
  - 그리드 오버레이 추가
  - 타이머 기능 추가

- 🎨 필터 적용하기
  - Core Image 필터 적용
  - 실시간 필터 미리보기
  - 필터 선택 UI

- 📊 성능 분석하기
  - FPS 측정
  - 메모리 사용량 추적
  - 최적화 포인트 찾기

---

## ✅ 완료 체크리스트

학습을 마치면 다음을 확인하세요:

### 기본
- [ ] 프로젝트를 성공적으로 실행했다
- [ ] SimpleCameraView에서 미리보기를 확인했다
- [ ] CaptureView에서 사진을 촬영했다
- [ ] CameraFlowView에서 전체 플로우를 테스트했다
- [ ] 성능 모니터를 확인했다

### 이론
- [ ] AVFoundation 구조를 이해한다
- [ ] AVCaptureSession과 AVCaptureDevice의 차이를 안다
- [ ] 카메라 권한 시스템을 이해한다
- [ ] 세션 구성 플로우를 안다

### 가이드
- [ ] AVFOUNDATION_THEORY.md를 읽었다
- [ ] CAMERA_SESSION_GUIDE.md를 읽었다
- [ ] PERFORMANCE_GUIDE.md를 읽었다
- [ ] 실무 활용 사례를 이해했다

---

## 📖 다음 단계

Day 16을 완료했다면:

1. **복습**: 코드를 다시 읽어보기
2. **응용**: 나만의 카메라 앱 만들기
3. **공유**: 배운 내용 정리하기
4. **다음**: 비디오 녹화 기능 추가

---

## 💬 도움이 필요하신가요?

- 📚 README.md - 전체 가이드
- 📖 AVFOUNDATION_THEORY.md - 이론 설명
- 🔧 CAMERA_SESSION_GUIDE.md - 구현 가이드
- ⚡ PERFORMANCE_GUIDE.md - 성능 측정

---

**즐거운 학습 되세요! 📸**

