# Day 11: 이미지 압축 효율 실험

> JPEG, PNG, HEIC, WebP 4가지 포맷의 압축 원리를 학습하고 용량-품질-속도 트레이드오프를 실험합니다

---

## 📚 학습 목표

### 핵심 목표
- **압축 이해**: 손실/무손실 압축의 원리와 차이점
- **포맷 비교**: JPEG, PNG, HEIC, WebP의 특성과 장단점
- **성능 실험**: 품질, 크기, 속도의 실제 트레이드오프 측정
- **최적화**: 실전에서 사용할 압축 전략 수립

### 학습 포인트

#### 1. 압축 방식
- **손실 압축**: JPEG, HEIC, WebP (높은 압축률, 품질 손실)
- **무손실 압축**: PNG (낮은 압축률, 품질 유지)

#### 2. 압축 알고리즘
- **JPEG**: DCT + 양자화 (가장 보편적)
- **PNG**: DEFLATE (무손실, 투명도)
- **HEIC**: HEVC 기반 (2배 효율, iOS 11+)
- **WebP**: VP8/LZ77 (유연한 압축, 웹 최적화)

#### 3. 트레이드오프
- 품질 ↑ = 크기 ↑, 압축률 ↓
- 압축률 ↑ = 품질 ↓, 속도 ↓
- 최적점: 품질 75-85%

---

## 🗂️ 파일 구조

```
day11/
├── README.md                           # 이 파일
├── 시작하기.md                         # 빠른 시작 가이드
│
├── IMAGE_COMPRESSION_THEORY.md         # 압축 이론
├── FORMAT_COMPARISON.md                # 포맷 비교
├── PERFORMANCE_GUIDE.md                # 성능 최적화
│
└── day11/
    ├── ContentView.swift               # 4개 탭 메인 뷰
    │
    ├── Core/                           # 압축 엔진
    │   ├── ImageCompressor.swift       # 압축 실행
    │   ├── FormatConverter.swift       # 포맷 변환
    │   ├── CompressionMetrics.swift    # 결과 모델
    │   └── ImageDownloader.swift       # 이미지 다운로드
    │
    ├── Views/                          # UI 뷰
    │   ├── InteractiveCompressionView.swift  # 인터랙티브 압축
    │   ├── BenchmarkView.swift               # 벤치마크
    │   ├── ComparisonResultView.swift        # 결과 비교
    │   └── ImageSelectorView.swift           # 이미지 선택
    │
    └── tool/                           # 분석 도구
        ├── PerformanceLogger.swift     # 성능 로깅
        ├── MemorySampler.swift         # 메모리 측정
        └── CompressionAnalyzer.swift   # 결과 분석
```

---

## 🚀 시작하기

### 1. 프로젝트 열기
```bash
cd day11
open day11.xcodeproj
```

### 2. 패키지 다운로드
첫 빌드 시 자동으로 SDWebImageWebPCoder가 다운로드됩니다.

### 3. 앱 실행
```
⌘R (Run)
```

### 4. 네트워크 연결 필요
이미지 다운로드를 위해 인터넷 연결이 필요합니다 (Picsum Photos API 사용).

---

## 📱 앱 구조

### Tab 1: 인터랙티브 압축

**기능**:
- 샘플 이미지 로드
- 4가지 포맷 선택 (JPEG, PNG, HEIC, WebP)
- 품질 슬라이더 (10-100%)
- 실시간 압축 결과 표시

**결과 정보**:
- 원본 크기
- 압축 후 크기
- 압축률 (%)
- 압축 시간 (ms)
- 압축된 이미지 미리보기

**컨트롤**:
- 포맷 버튼: JPEG / PNG / HEIC / WebP
- 품질 슬라이더: 10% ~ 100%
- 압축 실행 버튼

---

### Tab 2: 벤치마크

**기능**:
- 자동 벤치마크 실행
- 4가지 포맷 × 3가지 품질
- 총 12개 조합 테스트

**품질 프리셋**:
- **High (90%)**: 최고 품질
- **Medium (70%)**: 균형
- **Low (50%)**: 높은 압축

**결과 표시**:
- 포맷별 그룹화
- 품질별 상세 통계
- 크기, 압축률, 시간 비교
- 종합 분석 (최고 효율, 최고 속도, 최소 크기)

---

### Tab 3: 결과 비교

**기능**:
- 4가지 포맷 동시 비교
- 차트 시각화 (iOS 16+)
- 메트릭 선택 (파일 크기 / 압축률 / 처리 시간)

**분석**:
- 막대 그래프로 비교
- 상세 비교 테이블
- AI 추천 및 인사이트

**메트릭**:
- 파일 크기: 바이트 단위 비교
- 압축률: 압축 효율 비교
- 처리 시간: 속도 비교

---

### Tab 4: 이미지 선택

**기능**:
- 온라인 이미지 다운로드 (Picsum Photos)
- 샘플 이미지 생성
- 다양한 해상도 선택

**옵션**:
- **해상도**:
  - 작게 (300×300)
  - 중간 (800×600)
  - 크게 (1920×1080)
- **시드 번호**: 1-1000 (다른 이미지)

---

## 🎯 실전 사용 시나리오

### 시나리오 1: JPEG 품질 실험 (3분)

**목표**: 품질에 따른 크기와 압축률 변화 체험

1. **이미지 탭** → "샘플 이미지 로드"
2. **인터랙티브 탭** 이동
3. 포맷: **JPEG** 선택
4. 품질 **100%** → "압축 실행"
   - 결과 확인: 약 3-5MB
5. 품질 **80%** → "압축 실행"
   - 결과 확인: 약 1-2MB (50% 감소)
   - 품질: 육안으로 거의 차이 없음 ✅
6. 품질 **50%** → "압축 실행"
   - 결과 확인: 약 500KB-1MB
   - 품질: 눈에 띄는 저하 ⚠️

**학습 포인트**:
- Sweet spot은 품질 75-85%
- 80% 품질에서 50% 크기 감소
- 50% 이하는 품질 저하 심함

---

### 시나리오 2: 포맷별 효율 비교 (5분)

**목표**: JPEG vs PNG vs HEIC vs WebP 비교

1. **이미지 탭** → 해상도 "크게 (1920×1080)" 선택 → 다운로드
2. **벤치마크 탭** 이동
3. "벤치마크 시작" 클릭 → 자동 실행 (약 30초)
4. 결과 분석:

**예상 결과**:
```
포맷    | High (90%)  | Medium (70%) | Low (50%)
--------|-------------|--------------|----------
JPEG    | 2.5 MB      | 1.8 MB       | 1.2 MB
PNG     | 8.0 MB      | 8.0 MB       | 8.0 MB
HEIC    | 1.2 MB      | 900 KB       | 600 KB  ⭐
WebP    | 2.0 MB      | 1.4 MB       | 900 KB
```

**학습 포인트**:
- HEIC가 가장 효율적 (50% 절감)
- PNG는 무손실이라 크기 일정
- WebP가 JPEG보다 약간 작음

---

### 시나리오 3: 속도 vs 효율 (3분)

**목표**: 압축 속도 비교

1. **벤치마크 탭**에서 결과 확인
2. "종합 분석" 섹션 확인

**예상 결과**:
```
속도 순위:
1. JPEG:  15-25 ms  ⚡⚡⚡
2. WebP:  25-35 ms  ⚡⚡
3. HEIC:  40-60 ms  ⚡⚡
4. PNG:   80-150 ms ⚡

효율 순위:
1. HEIC:  88% 압축  ⭐⭐⭐
2. WebP:  82% 압축  ⭐⭐⭐
3. JPEG:  75% 압축  ⭐⭐
4. PNG:   25% 압축  ⭐
```

**학습 포인트**:
- JPEG가 가장 빠름 (하드웨어 가속)
- HEIC는 느리지만 최고 효율
- 트레이드오프 존재

---

### 시나리오 4: 실전 최적화 (5분)

**목표**: 실제 사용 케이스별 최적 설정 찾기

#### 케이스 1: 웹 이미지
```
목표: 빠른 로딩
추천: JPEG 75-80%
이유: 
  - 보편적 호환성
  - 빠른 속도
  - 충분한 압축
```

#### 케이스 2: iOS 사진 앱
```
목표: 저장 공간 절약
추천: HEIC 85-90%
이유:
  - 최고 압축 효율
  - iOS 11+ 지원
  - 좋은 품질
```

#### 케이스 3: 로고/아이콘
```
목표: 투명도 + 선명함
추천: PNG
이유:
  - 무손실
  - 알파 채널
  - 깨끗한 경계
```

#### 케이스 4: 소셜 미디어
```
목표: 빠른 업로드
추천: JPEG 70-75%
이유:
  - 작은 크기
  - 빠른 업로드
  - 충분한 품질
```

---

### 시나리오 5: 메모리 최적화 (10분)

**목표**: 대용량 이미지 효율적 압축

1. **이미지 탭** → 해상도 "크게" → 다운로드
2. **인터랙티브 탭** → 여러 포맷/품질로 압축
3. 메모리 사용량 관찰 (Xcode Instruments)

**최적화 팁**:
```swift
// ❌ 비효율
let image = UIImage(named: "huge")!
let data = image.jpegData(compressionQuality: 0.8)

// ✅ 효율적
// 1. 다운샘플링 먼저
let downsampled = downsampleImage(to: targetSize)
// 2. 압축
let data = downsampled.jpegData(compressionQuality: 0.8)
```

---

## 📊 성능 벤치마크

### 테스트 환경
- 이미지: 1920×1080 사진
- 품질: 80%
- 기기: iPhone 시뮬레이터

### 결과

| 포맷 | 파일 크기 | 압축률 | 압축 시간 | 상대 효율 |
|------|-----------|--------|-----------|-----------|
| **JPEG** | 2.5 MB | 75% | 18 ms | ⭐⭐⭐ |
| **PNG** | 7.5 MB | 25% | 120 ms | ⭐ |
| **HEIC** | 1.2 MB | 88% | 45 ms | ⭐⭐⭐⭐⭐ |
| **WebP** | 1.8 MB | 82% | 30 ms | ⭐⭐⭐⭐ |

**결론**:
- HEIC가 최고 압축 효율 (2배)
- JPEG가 최고 속도 (2.5배 빠름)
- WebP가 균형 잡힌 선택

---

## 💡 핵심 학습 포인트

### 1. 압축 원리 이해

```
손실 압축 (Lossy)
├─ 원리: 인지 어려운 데이터 제거
├─ 장점: 높은 압축률 (80-95%)
├─ 단점: 품질 손실, 복원 불가
└─ 포맷: JPEG, HEIC, WebP

무손실 압축 (Lossless)
├─ 원리: 중복 데이터 제거
├─ 장점: 품질 유지, 완벽 복원
├─ 단점: 낮은 압축률 (20-50%)
└─ 포맷: PNG, WebP (무손실 모드)
```

### 2. 포맷 선택 가이드

```
JPEG
├─ 사용: 일반 사진, 웹 이미지
├─ 장점: 보편성, 속도
└─ 단점: 투명도 미지원

PNG
├─ 사용: 로고, 아이콘, 투명 이미지
├─ 장점: 무손실, 투명도
└─ 단점: 큰 크기

HEIC
├─ 사용: iOS 전용 앱
├─ 장점: 최고 효율 (2배)
└─ 단점: iOS 11+ 필수

WebP
├─ 사용: 웹 최적화
├─ 장점: 유연함 (손실/무손실)
└─ 단점: iOS 14+ 권장
```

### 3. 최적 품질 설정

```
품질 범위:
100%: 최고 품질, 최대 크기
90%:  매우 좋음, 큰 크기
80%:  좋음, 균형 ✅ 권장
70%:  괜찮음, 작은 크기
50%:  눈에 띄는 저하
< 30%: 심각한 품질 저하
```

---

## 🎓 학습 체크리스트

### 기본
- [ ] 손실/무손실 압축 차이 이해
- [ ] 4가지 포맷의 특성 파악
- [ ] 품질-크기 트레이드오프 이해
- [ ] Swift 압축 API 사용법 숙지

### 응용
- [ ] 인터랙티브 압축 실험 완료
- [ ] 벤치마크 실행 및 분석
- [ ] 포맷별 비교 결과 해석
- [ ] 실전 최적화 전략 수립

### 심화
- [ ] 압축 알고리즘 원리 이해 (DCT, DEFLATE)
- [ ] HEIC 인코딩 구현
- [ ] WebP 통합
- [ ] 성능 프로파일링

---

## 📖 참고 자료

### 이론 문서 (필수)
1. **IMAGE_COMPRESSION_THEORY.md**: 압축 기본 원리
2. **FORMAT_COMPARISON.md**: 포맷별 상세 비교
3. **PERFORMANCE_GUIDE.md**: 성능 최적화 기법

### Apple 문서
- [UIImage Compression](https://developer.apple.com/documentation/uikit/uiimage/1624115-jpegdata)
- [Image I/O Programming Guide](https://developer.apple.com/library/archive/documentation/GraphicsImaging/Conceptual/ImageIOGuide/)
- [Core Image Programming Guide](https://developer.apple.com/library/archive/documentation/GraphicsImaging/Conceptual/CoreImaging/)

### 외부 자료
- [JPEG Standard](https://jpeg.org/jpeg/)
- [PNG Specification](http://www.libpng.org/pub/png/)
- [HEIF/HEIC Format](https://nokiatech.github.io/heif/)
- [WebP Documentation](https://developers.google.com/speed/webp)

### 이전 학습
- **Day 4**: 이미지 메타데이터 (EXIF)
- **Day 5**: 이미지 리사이징 & 포맷 변환
- **Day 8**: URLSession 비동기 이미지 로딩

---

## 🎯 다음 단계

Day 11을 완료했다면:

### 1. 실전 적용
- 자신의 프로젝트에 압축 로직 적용
- 최적 포맷 및 품질 선택
- 성능 벤치마크 실행

### 2. 고급 기능
- 적응형 압축 (이미지 특성 기반)
- 타겟 크기 맞추기
- 배치 처리 최적화

### 3. 최적화
- 다운샘플링 + 압축 조합
- 백그라운드 처리
- 메모리 효율 개선

---

## 💬 핵심 요약

### 압축의 힘
- 🎯 **80% 압축률** (품질 80% 설정)
- ⚡ **2배 효율** (HEIC vs JPEG)
- 💾 **50% 저장 공간** 절약

### 포맷 선택
- **일반 사진**: JPEG 80%
- **iOS 전용**: HEIC 85%
- **웹 최적화**: WebP 80%
- **로고/아이콘**: PNG

### 최적화 전략
- 다운샘플링 먼저
- 품질 75-85% 권장
- 포맷 자동 선택
- 배치 처리 활용

---

**Happy Compressing! 📦**

*효율적인 이미지 압축으로 사용자 경험을 향상시키세요!*


