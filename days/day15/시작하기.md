# Day 15 시작하기

> PHPhotoLibrary 이미지 선택기 학습을 위한 빠른 시작 가이드

---

## 🎯 오늘의 학습 목표

사진 라이브러리 접근, 권한 관리, EXIF 메타데이터를 학습합니다.

---

## ⚡ 빠른 시작 (5분)

### 1단계: 프로젝트 열기
```bash
cd day15
open day15.xcodeproj
```

### 2단계: 권한 설정 확인

⚠️ **중요**: Info.plist에 권한 설명이 포함되어 있는지 확인하세요.

**필수 권한**:
- `NSPhotoLibraryUsageDescription`: 사진 읽기 권한
- `NSPhotoLibraryAddUsageDescription`: 사진 저장 권한 (선택)

### 3단계: 앱 실행
```
⌘R (Run)
```

**중요**: 실제 기기에서 테스트하는 것을 권장합니다. 시뮬레이터는 사진 라이브러리가 비어있을 수 있습니다.

---

## 📚 학습 순서

### 1️⃣ 이론 학습 (30분)

**PHOTOS_THEORY.md** 읽기
- PHPhotoLibrary 구조
- PHAsset, PHImageManager 사용법
- 이미지 로딩 패턴

**PERMISSION_GUIDE.md** 읽기
- iOS 14+ 권한 시스템
- Limited 권한 처리
- 권한 변경 감지

**PERFORMANCE_GUIDE.md** 읽기
- 썸네일 우선 로딩
- Lazy 로딩 전략
- 메모리 최적화

### 2️⃣ 기본 실습 (40분)

**PhotosPickerView**
- SwiftUI PhotosPicker 기본 사용법
- 단일/다중 선택
- 이미지 로드

**PHAssetGalleryView**
- PHAsset으로 갤러리 그리드 구현
- 썸네일 우선 로딩
- 스크롤 성능 최적화

**PermissionFlowView**
- 권한 상태 확인
- 권한 요청 흐름 테스트
- Limited 권한 시나리오

### 3️⃣ 실전 응용 (30분)

**MetadataView**
- 선택한 이미지의 EXIF 메타데이터 읽기
- 촬영 정보, 위치 정보 표시

**ComparisonView**
- PhotosPicker vs UIImagePickerController 비교
- 각각의 장단점 이해

### 4️⃣ 가이드 읽기 (20분)
```
PHOTOS_THEORY.md          - 이론 설명
PERMISSION_GUIDE.md        - 권한 시스템
PERFORMANCE_GUIDE.md      - 성능 최적화
```

**총 학습 시간: 약 2시간**

---

## 🔑 핵심 코드

### 권한 확인 및 요청
```swift
// 권한 확인
let status = PHPhotoLibrary.authorizationStatus(for: .readWrite)

// 권한 요청
PHPhotoLibrary.requestAuthorization(for: .readWrite) { status in
    switch status {
    case .authorized:
        // 전체 접근 허용
    case .limited:
        // 제한적 접근 허용
    case .denied:
        // 거부됨
    default:
        break
    }
}
```

### PHAsset Fetch
```swift
let fetchOptions = PHFetchOptions()
fetchOptions.sortDescriptors = [NSSortDescriptor(key: "creationDate", ascending: false)]

let assets = PHAsset.fetchAssets(with: .image, options: fetchOptions)
```

### 이미지 로딩
```swift
// 썸네일
imageManager.requestImage(
    for: asset,
    targetSize: CGSize(width: 200, height: 200),
    contentMode: .aspectFill,
    options: nil
) { image, info in
    // 썸네일 표시
}
```

### PhotosPicker 사용
```swift
PhotosPicker(selection: $selectedItem, matching: .images) {
    Label("사진 선택", systemImage: "photo.on.rectangle.angled")
}
.onChange(of: selectedItem) { _, newItem in
    Task {
        if let data = try? await newItem?.loadTransferable(type: Data.self) {
            let image = UIImage(data: data)
        }
    }
}
```

---

## ⚠️ 주의사항

### 실제 기기 테스트 권장

시뮬레이터보다 **실제 기기**를 권장합니다:

**장점**:
- ✅ 실제 사진 라이브러리 접근
- ✅ 권한 시스템 정확한 테스트
- ✅ 성능 측정 정확도 향상

### 권한 설정

**필수**: Info.plist에 권한 설명 추가
```xml
<key>NSPhotoLibraryUsageDescription</key>
<string>사진을 선택하여 이미지를 불러오기 위해 사진 라이브러리 접근이 필요합니다.</string>
```

### Limited 권한

iOS 14+에서 사용자가 "선택한 사진만" 허용하면:
- 선택한 사진만 `PHAsset.fetchAssets()`에서 반환
- 추가 사진 선택 UI 제공 가능

---

## 🐛 문제 해결

### "권한이 거부되었습니다" 오류

**원인**: 사용자가 권한을 거부함

**해결**:
1. 설정 앱으로 이동 안내
2. 사진 접근 권한 허용
3. 앱 재시작

### "사진이 없습니다" 메시지

**원인**: 시뮬레이터에 사진이 없음

**해결**:
1. 실제 기기에서 테스트
2. 또는 시뮬레이터에 사진 추가:
   - 웹에서 이미지 다운로드
   - Finder에서 시뮬레이터로 드래그

### Limited 권한에서 사진이 보이지 않음

**원인**: 사용자가 선택한 사진만 접근 가능

**해결**:
1. "더 많은 사진 선택" 버튼 제공
2. `PHPhotoLibrary.shared().presentLimitedLibraryPicker()` 호출

---

## 📱 실제 기기 테스트

### 설정

1. iPhone을 Mac에 연결
2. Xcode에서 기기 선택
3. Signing & Capabilities 설정
4. ⌘R 실행

### 권한 테스트

1. 앱 실행 시 권한 요청 팝업 확인
2. "선택한 사진만" 선택하여 Limited 권한 테스트
3. "모든 사진 허용" 선택하여 Authorized 권한 테스트
4. 설정에서 권한 변경 후 앱 재시작하여 변경 감지 확인

---

## 🎓 학습 팁

### 효과적인 학습 방법

1. **이론 먼저**: PHOTOS_THEORY.md 정독
2. **코드 실행**: 각 View를 직접 실행해보기
3. **코드 수정**: 값을 바꿔가며 실험
4. **본인 사진**: 실제 사진으로 테스트
5. **가이드 읽기**: PERMISSION_GUIDE.md, PERFORMANCE_GUIDE.md

### 실습 아이디어

- 📊 본인의 사진 통계 분석
  - 가장 많이 사용한 카메라 모델은?
  - 어느 위치에서 가장 많이 촬영했나?
  - 촬영 시간대 분포는?

- 🗺️ 사진 지도 만들기
  - GPS 태그가 있는 모든 사진
  - 지도에 마커로 표시
  - 탭하면 사진 보기

- 📸 EXIF 비교 도구
  - 여러 카메라 모델 비교
  - 설정에 따른 결과 비교
  - 베스트 설정 찾기

---

## ✅ 완료 체크리스트

학습을 마치면 다음을 확인하세요:

### 기본
- [ ] 프로젝트를 성공적으로 실행했다
- [ ] PhotosPickerView에서 이미지를 선택했다
- [ ] PHAssetGalleryView에서 갤러리를 확인했다
- [ ] PermissionFlowView에서 권한 흐름을 테스트했다
- [ ] MetadataView에서 EXIF를 확인했다
- [ ] ComparisonView에서 비교를 확인했다

### 이론
- [ ] PHPhotoLibrary 구조를 이해한다
- [ ] PHAsset과 PHImageManager의 차이를 안다
- [ ] iOS 14+ 권한 시스템을 이해한다
- [ ] 썸네일 우선 로딩 전략을 안다

### 가이드
- [ ] PHOTOS_THEORY.md를 읽었다
- [ ] PERMISSION_GUIDE.md를 읽었다
- [ ] PERFORMANCE_GUIDE.md를 읽었다
- [ ] 실무 활용 사례를 이해했다

---

## 📖 다음 단계

Day 15를 완료했다면:

1. **복습**: 코드를 다시 읽어보기
2. **응용**: 나만의 갤러리 앱 만들기
3. **공유**: 배운 내용 정리하기
4. **다음**: Vision 프레임워크로 이미지 분석

---

## 💬 도움이 필요하신가요?

- 📚 README.md - 전체 가이드
- 📖 PHOTOS_THEORY.md - 이론 설명
- 🔧 PERMISSION_GUIDE.md - 권한 시스템
- ⚡ PERFORMANCE_GUIDE.md - 성능 최적화

---

**즐거운 학습 되세요! 📸**

