# Day 5 시작하기

> 이미지 리사이즈 & 포맷 변환 학습을 위한 빠른 시작 가이드

---

## 🎯 오늘의 학습 목표

iOS에서 이미지를 효율적으로 리사이즈하고 포맷을 변환하는 방법을 배웁니다.

---

## ⚡ 빠른 시작 (5분)

### 1단계: 프로젝트 열기
```bash
cd day05
open day05.xcodeproj
```

### 2단계: 샘플 이미지 준비

⚠️ **중요**: 고해상도 이미지 (4000 × 3000 이상) 필요합니다.

#### 옵션 A: iPhone에서 촬영 (권장)
1. iPhone 카메라 앱 실행
2. 사진 촬영 (풍경이나 인물)
3. Mac으로 AirDrop 전송
4. Xcode에서 사용

#### 옵션 B: 웹에서 다운로드
```
1. https://unsplash.com 접속
2. 검색: "landscape" 또는 "nature"
3. 마음에 드는 사진 선택
4. "Download free" 클릭 (Large 또는 Original)
5. 다운로드 폴더에서 찾기
```

**권장 사이트**:
- [Unsplash](https://unsplash.com) - 고품질, 무료
- [Pexels](https://pexels.com) - 다양한 사진
- [Pixabay](https://pixabay.com) - 상업적 사용 가능

### 3단계: Assets에 이미지 추가

1. Xcode에서 `day05/day05/Assets.xcassets` 열기
2. 좌측 하단 `+` 클릭 → "New Image Set"
3. 이름을 `sample`로 변경
4. 준비한 이미지를 "Universal" 슬롯에 드래그 앤 드롭
5. Attributes Inspector 확인:
   - Resizing: Preserve Vector Data ❌
   - Scales: Single Scale ✅

### 4단계: 앱 실행
```
⌘R
```

---

## 📚 학습 순서

### 1️⃣ 이론 학습 (30분)

**IMAGE_RESIZE_THEORY.md 읽기**
- 4가지 리사이즈 방법 이해
  - UIGraphicsImageRenderer (간편)
  - Core Graphics (제어)
  - vImage (속도)
  - Image I/O (메모리)
- 다운샘플링 개념
- 성능 비교표

**FORMAT_CONVERSION_GUIDE.md 읽기**
- JPEG vs PNG vs HEIC
- 압축 원리
- 포맷 선택 전략

**핵심 개념 체크**:
```
Q: 48MB 이미지를 300px 썸네일로 만드는 가장 효율적인 방법은?
A: Image I/O 다운샘플링 (메모리 ~5MB만 사용)

Q: HEIC가 JPEG보다 얼마나 작은가?
A: 동일 화질에서 40~50% 작음

Q: 100개 이미지를 배치 처리할 때 주의사항은?
A: autoreleasepool + 병렬 처리
```

### 2️⃣ 리사이즈 실습 (30분)

**ResizeMethodsView 실행**
- 4가지 방법으로 동일 이미지 리사이즈
- 시간, 메모리, 화질 비교
- 예상 결과:
  ```
  UIGraphics:    120ms, 52MB
  Core Graphics:  95ms, 52MB
  vImage:         35ms, 52MB  ← 가장 빠름!
  Image I/O:      45ms, 10MB  ← 메모리 효율!
  ```

**학습 포인트**:
- vImage가 왜 빠른지 (SIMD)
- Image I/O가 메모리를 어떻게 절약하는지 (다운샘플링)
- 각 방법을 언제 사용해야 하는지

### 3️⃣ 포맷 변환 실습 (30분)

**FormatComparisonView 실행**
- JPEG, PNG, HEIC 비교
- 파일 크기와 화질 확인
- 예상 결과:
  ```
  JPEG 90%: 1.8MB
  JPEG 70%: 620KB
  PNG:      5.2MB  ← 가장 큼
  HEIC 90%: 950KB  ← 고품질, 작은 크기!
  HEIC 70%: 350KB
  ```

**QualityBenchmarkView 실행**
- JPEG quality 10%~100% 단계별 측정
- 그래프로 시각화
- 최적 품질 찾기 (보통 0.8 권장)

**학습 포인트**:
- Quality 0.8 vs 1.0의 차이 (파일 크기 50% 차이)
- HEIC의 효율성 (iOS 11+)
- 투명도가 필요한 경우 PNG 사용

### 4️⃣ 배치 처리 실습 (30분)

**BatchProcessingView 실행**
- 여러 이미지 일괄 변환
- 진행률 확인
- 최적화 효과 체험

**학습 포인트**:
- autoreleasepool의 중요성
- 병렬 처리로 속도 향상 (8배!)
- 메모리 압박 대응

### 5️⃣ 성능 가이드 읽기 (20분)

**PERFORMANCE_GUIDE.md 읽기**
- 메모리 최적화 전략
- 속도 최적화 기법
- 실전 패턴

**핵심 패턴**:
```swift
// 메모리 최적화
for url in imageURLs {
    autoreleasepool {
        let thumbnail = downsampleImage(from: url, to: size)
        saveThumbnail(thumbnail)
    }
}

// 속도 최적화 (비동기)
DispatchQueue.global().async {
    let resized = resize(image, to: size)
    DispatchQueue.main.async {
        imageView.image = resized
    }
}
```

**총 학습 시간: 약 2시간 20분**

---

## 🔑 핵심 코드

### 다운샘플링

```swift
func downsampleImage(from url: URL, to targetSize: CGSize) -> UIImage? {
    let options: [CFString: Any] = [
        kCGImageSourceThumbnailMaxPixelSize: max(targetSize.width, targetSize.height),
        kCGImageSourceCreateThumbnailFromImageAlways: true,
        kCGImageSourceCreateThumbnailWithTransform: true
    ]
    
    guard let source = CGImageSourceCreateWithURL(url as CFURL, nil),
          let image = CGImageSourceCreateThumbnailAtIndex(source, 0, options as CFDictionary) else {
        return nil
    }
    
    return UIImage(cgImage: image)
}
```

### HEIC 변환

```swift
func convertToHEIC(image: UIImage, quality: CGFloat) -> Data? {
    guard let cgImage = image.cgImage else { return nil }
    
    let data = NSMutableData()
    guard let destination = CGImageDestinationCreateWithData(
        data,
        AVFileType.heic as CFString,
        1,
        nil
    ) else { return nil }
    
    let options: [CFString: Any] = [
        kCGImageDestinationLossyCompressionQuality: quality
    ]
    
    CGImageDestinationAddImage(destination, cgImage, options as CFDictionary)
    CGImageDestinationFinalize(destination)
    
    return data as Data
}
```

### 배치 처리

```swift
func processBatch(_ urls: [URL]) {
    let queue = DispatchQueue(label: "batch", attributes: .concurrent)
    let group = DispatchGroup()
    
    for url in urls {
        group.enter()
        queue.async {
            autoreleasepool {
                let thumbnail = downsampleImage(from: url, to: size)
                saveThumbnail(thumbnail)
                group.leave()
            }
        }
    }
    
    group.wait()
}
```

---

## ⚠️ 주의사항

### 샘플 이미지 크기
- **너무 작은 이미지** (< 1000px): 리사이즈 효과 미미
- **권장 크기**: 4000 × 3000 이상
- **파일 크기**: 2MB 이상

### iOS 버전
- HEIC: iOS 11+ 필요
- 구형 기기에서는 HEIC 테스트 불가
- 폴백: JPEG 사용

### 시뮬레이터 vs 실기기
- **시뮬레이터**: Mac CPU 사용 (성능 다름)
- **실기기**: 실제 A-시리즈 칩 사용
- **권장**: 실기기에서 테스트

---

## 🐛 문제 해결

### "이미지를 로드할 수 없습니다" 오류

**원인**: 샘플 이미지가 없거나 경로 오류

**해결**:
1. Assets.xcassets 열기
2. `sample` imageset 확인
3. 이미지가 없다면 다시 추가
4. Clean Build Folder (⌘⇧K)
5. 재실행 (⌘R)

### 앱 크래시 (메모리 부족)

**원인**: 큰 이미지를 너무 많이 로드

**해결**:
```swift
// ❌ 나쁜 예
for url in urls {
    let image = UIImage(contentsOfFile: url.path)  // 메모리 폭발
}

// ✅ 좋은 예
for url in urls {
    autoreleasepool {
        let image = downsampleImage(from: url, to: size)
    }
}
```

### HEIC 변환 실패

**원인**: iOS 11 미만 기기

**해결**:
```swift
if #available(iOS 11.0, *) {
    let heic = convertToHEIC(image, quality: 0.8)
} else {
    let jpeg = image.jpegData(compressionQuality: 0.8)
}
```

### 느린 성능 (시뮬레이터)

**원인**: 시뮬레이터는 Mac CPU 사용

**해결**:
- 실제 iPhone/iPad에서 테스트
- Release 모드로 빌드 (Product > Scheme > Edit Scheme > Run > Release)

---

## 📱 실제 기기 테스트

시뮬레이터보다 **실제 기기**를 강력히 권장합니다:

### 장점
- ✅ 실제 A-시리즈 칩 성능
- ✅ 정확한 메모리 측정
- ✅ vImage 최적화 확인
- ✅ 실제 사용자 경험

### 설정
1. iPhone/iPad를 Mac에 연결
2. Xcode에서 기기 선택 (상단 바)
3. Signing & Capabilities 설정
   - Team 선택
   - Bundle Identifier 확인
4. ⌘R 실행

---

## 🎓 학습 팁

### 효과적인 학습 방법

1. **이론 먼저**: 문서를 꼭 읽어보세요
   - IMAGE_RESIZE_THEORY.md
   - FORMAT_CONVERSION_GUIDE.md

2. **코드 실행**: 각 View를 직접 실행

3. **코드 수정**: 값을 바꿔가며 실험
   - Quality를 0.5로 바꾸면?
   - 타겟 크기를 500px로 바꾸면?
   - vImage 대신 UIGraphics를 쓰면?

4. **성능 측정**: 직접 측정하고 비교

5. **실전 적용**: 나만의 기능 추가

### 실습 아이디어

#### 📊 성능 비교 차트
- 4가지 방법의 시간/메모리를 차트로 시각화
- SwiftUI Charts 사용

#### 🎨 포맷 크기 계산기
- 이미지를 여러 포맷/품질로 변환
- 예상 파일 크기 계산
- 최적 옵션 추천

#### 📸 프로필 사진 크로퍼
- 정사각형 크롭
- 512px 리사이즈
- HEIC/JPEG 선택

#### 🖼️ 배치 이미지 컨버터
- 여러 이미지 선택
- 일괄 리사이즈 + 포맷 변환
- 진행률 표시

---

## ✅ 완료 체크리스트

학습을 마치면 다음을 확인하세요:

### 기본
- [ ] 프로젝트를 성공적으로 실행했다
- [ ] ResizeMethodsView에서 4가지 방법을 비교했다
- [ ] FormatComparisonView에서 포맷 차이를 확인했다
- [ ] QualityBenchmarkView에서 품질/크기를 측정했다
- [ ] BatchProcessingView에서 배치 처리를 체험했다

### 이론
- [ ] 다운샘플링이 무엇인지 설명할 수 있다
- [ ] vImage의 장점을 안다
- [ ] HEIC가 JPEG보다 왜 효율적인지 안다
- [ ] autoreleasepool을 언제 사용해야 하는지 안다

### 실습
- [ ] 4가지 방법의 성능 차이를 측정했다
- [ ] HEIC로 변환할 수 있다
- [ ] 배치 처리를 최적화할 수 있다
- [ ] 실기기에서 테스트했다

### 가이드
- [ ] IMAGE_RESIZE_THEORY.md를 읽었다
- [ ] FORMAT_CONVERSION_GUIDE.md를 읽었다
- [ ] PERFORMANCE_GUIDE.md를 읽었다

---

## 📖 다음 단계

Day 5를 완료했다면:

1. **복습**: 핵심 코드를 다시 읽어보기
2. **응용**: 나만의 기능 추가해보기
3. **최적화**: 실제 앱에 적용하기
4. **공유**: 배운 내용 정리하기
5. **다음**: Day 6로 진행

---

## 💬 도움이 필요하신가요?

- 📚 README.md - 전체 가이드
- 📖 IMAGE_RESIZE_THEORY.md - 리사이즈 이론
- 🎨 FORMAT_CONVERSION_GUIDE.md - 포맷 변환
- ⚡ PERFORMANCE_GUIDE.md - 성능 최적화
- 🔧 각 .swift 파일의 주석

---

**즐거운 학습 되세요! 🖼️**

*효율적인 이미지 처리를 마스터하세요!*

