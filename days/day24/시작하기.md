# 24일차: 커스텀 CIFilter 제작하기

오늘은 내장 필터의 한계를 넘어, 나만의 이미지 처리 로직을 담은 **커스텀 CIFilter**를 만들어봅니다. Metal Shading Language(MSL)를 아주 간단하게 사용하여 강력한 색감 필터를 구현합니다.

## 학습 목표
1. **CIFilter 구조 이해**: 입력, 커널, 출력의 흐름 파악.
2. **Metal Kernel 작성**: `CIColorKernel`을 위한 간단한 Metal 코드 작성법 학습.
3. **커스텀 필터 구현**: 단순 틴트 필터부터 파라미터를 받는 동적 필터까지 구현.
4. **성능 최적화**: `CIContext` 재사용 및 파이프라인 구성 실습.

## 실습 내용

### 1. 기본 필터 구현 (Pink Tint)
- 가장 단순한 형태의 Color Kernel.
- 입력 픽셀에 고정된 분홍색 값을 곱하여 색감을 입힙니다.

### 2. 감정 필터 (Emotion Filter) - 과제 A
- `inputEmotion` (0.0 ~ 100.0) 값에 따라 색감을 실시간으로 변화시킵니다.
- **높은 점수**: 따뜻하고 밝은 톤 (Orange/Yellow)
- **낮은 점수**: 차갑고 어두운 톤 (Blue/Cyan)
- Metal 코드 내에서 `mix` 함수를 사용하여 색상을 부드럽게 보간합니다.

### 3. 하이라이트 필터 (Highlight Filter) - 과제 B
- 이미지의 밝기(Luminance)를 계산하여, **밝은 영역에만** 특정 색상(Pink 등)을 입힙니다.
- 어두운 영역은 원본을 유지합니다.
- 조건문 대신 벡터 연산(`step`, `smoothstep`)을 사용하여 GPU 성능을 최적화합니다.

### 4. 파이프라인 구성
- `CIImage` -> `Tint` -> `Blur` -> `Vignette` 순서로 필터를 연결하여 복합 효과를 냅니다.
- Core Image의 지연 평가(Lazy Evaluation) 특성을 이해합니다.

## 주의사항
- **시뮬레이터 vs 실기기**: Metal 기반 코드는 시뮬레이터에서도 동작하지만, 실기기에서 성능이 훨씬 정확하게 측정됩니다.
- **에러 처리**: 커널 컴파일 실패 시 앱이 죽지 않도록 `guard` 문 등으로 안전하게 처리해야 하지만, 실습 예제는 강제 언래핑(`!`)을 일부 사용하여 코드를 단순화했습니다. 실전에서는 예외 처리가 필수입니다.

