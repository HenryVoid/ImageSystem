# Day 17 시작하기

> AVFoundation 동영상 녹화 학습을 위한 빠른 시작 가이드

---

## 🎯 오늘의 학습 목표

카메라 + 마이크 권한 요청, 세션 구성, 동영상 녹화, 저장 및 재생을 학습합니다.

---

## ⚡ 빠른 시작 (5분)

### 1단계: 프로젝트 열기

```bash
cd day17
open day17.xcodeproj
```

### 2단계: 권한 설정 확인

⚠️ **중요**: Info.plist에 권한 설명이 포함되어 있는지 확인하세요.

**필수 권한**:
- `NSCameraUsageDescription`: 카메라 접근 권한
- `NSMicrophoneUsageDescription`: 마이크 접근 권한
- `NSPhotoLibraryAddUsageDescription`: 동영상 저장 권한 (선택)

### 3단계: 앱 실행

```
⌘R (Run)
```

**중요**: **실제 기기에서만 테스트 가능합니다!** 시뮬레이터는 카메라와 마이크를 사용할 수 없습니다.

---

## 📚 학습 순서

### 1️⃣ 이론 학습 (30분)

**VIDEO_RECORDING_THEORY.md** 읽기
- AVCaptureMovieFileOutput 기본 개념
- 카메라 + 마이크 권한 요청
- 세션 구성 원리

**VIDEO_RECORDING_GUIDE.md** 읽기
- 단계별 구현 가이드
- 권한 → 세션 → 녹화 → 재생 플로우

**PERFORMANCE_GUIDE.md** 읽기
- 성능 측정 방법
- FPS, 메모리, 파일 크기 모니터링

### 2️⃣ 기본 실습 (40분)

**SimpleVideoView**
- 카메라 + 마이크 권한 요청
- 기본 미리보기 표시
- 세션 시작/중지

**RecordingView**
- 동영상 녹화 기능
- 녹화 시간 표시
- 카메라 전환 (전면/후면)

### 3️⃣ 실전 응용 (30분)

**PlaybackView**
- 저장된 동영상 목록 표시
- AVPlayer로 동영상 재생
- 재생 컨트롤

**VideoFlowView**
- 전체 플로우 통합
- 성능 모니터 표시
- 실시간 FPS 및 메모리 측정

### 4️⃣ 가이드 읽기 (20분)

```
VIDEO_RECORDING_THEORY.md      - 이론 설명
VIDEO_RECORDING_GUIDE.md       - 구현 가이드
PERFORMANCE_GUIDE.md           - 성능 측정
```

**총 학습 시간: 약 2시간**

---

## 🔑 핵심 코드

### 권한 확인 및 요청

```swift
// 카메라 권한
let cameraStatus = AVCaptureDevice.authorizationStatus(for: .video)
if cameraStatus == .notDetermined {
    await AVCaptureDevice.requestAccess(for: .video)
}

// 마이크 권한
let micStatus = AVCaptureDevice.authorizationStatus(for: .audio)
if micStatus == .notDetermined {
    await AVCaptureDevice.requestAccess(for: .audio)
}
```

### 세션 구성

```swift
let session = AVCaptureSession()
session.sessionPreset = .high

// 카메라 입력
let camera = AVCaptureDevice.default(.builtInWideAngleCamera, 
                                     for: .video, 
                                     position: .back)
let videoInput = try AVCaptureDeviceInput(device: camera)
session.addInput(videoInput)

// 마이크 입력
let microphone = AVCaptureDevice.default(.builtInMicrophone, 
                                       for: .audio, 
                                       position: .unspecified)
let audioInput = try AVCaptureDeviceInput(device: microphone)
session.addInput(audioInput)

// 동영상 출력
let movieOutput = AVCaptureMovieFileOutput()
session.addOutput(movieOutput)
```

### 동영상 녹화

```swift
// 녹화 시작
let videoURL = documentsPath.appendingPathComponent("video.mov")
movieOutput.startRecording(to: videoURL, recordingDelegate: self)

// 녹화 중지
movieOutput.stopRecording()

// 델리게이트
func fileOutput(_ output: AVCaptureMovieFileOutput,
                didFinishRecordingTo outputFileURL: URL,
                from connections: [AVCaptureConnection],
                error: Error?) {
    // 녹화 완료 처리
}
```

### 동영상 재생

```swift
import AVKit

VideoPlayer(player: AVPlayer(url: videoURL))
    .frame(height: 300)
```

---

## ⚠️ 주의사항

### 실제 기기 테스트 필수

시뮬레이터보다 **실제 기기**를 사용해야 합니다:

**이유**:
- ✅ 실제 카메라 하드웨어 접근
- ✅ 실제 마이크 하드웨어 접근
- ✅ 권한 시스템 정확한 테스트
- ✅ 성능 측정 정확도 향상

### 권한 설정

**필수**: Info.plist에 권한 설명 추가

```xml
<key>NSCameraUsageDescription</key>
<string>동영상을 녹화하기 위해 카메라 접근이 필요합니다.</string>

<key>NSMicrophoneUsageDescription</key>
<string>동영상에 오디오를 포함하기 위해 마이크 접근이 필요합니다.</string>
```

### 세션 생명주기

```swift
// 뷰가 나타날 때
.onAppear {
    sessionManager.startSession()
}

// 뷰가 사라질 때
.onDisappear {
    sessionManager.stopSession()
}
```

### 녹화 중 세션 변경 금지

녹화 중에는 세션 설정을 변경하면 안 됩니다:
- 카메라 전환 불가
- Preset 변경 불가
- 입력/출력 추가/제거 불가

---

## 🐛 문제 해결

### "카메라를 사용할 수 없습니다" 오류

**원인**: 시뮬레이터 사용 또는 권한 거부

**해결**:
1. 실제 기기에서 테스트
2. Info.plist에 권한 설명 확인
3. 설정 앱에서 권한 확인

### "마이크를 사용할 수 없습니다" 오류

**원인**: 마이크 권한 거부

**해결**:
1. Info.plist에 `NSMicrophoneUsageDescription` 확인
2. 설정 앱에서 마이크 권한 확인

### "녹화가 시작되지 않습니다"

**원인**: 세션 설정 전에 녹화 시작 또는 권한 없음

**해결**:
- `setupSession()` 완료 후 시작
- 카메라 + 마이크 권한 모두 확인
- `sessionQueue`에서 순차적으로 처리

### "녹화된 동영상이 재생되지 않습니다"

**원인**: 파일 경로 오류 또는 파일 손상

**해결**:
1. 파일 URL 확인
2. 파일이 실제로 존재하는지 확인
3. 파일 크기가 0이 아닌지 확인

---

## 📱 실제 기기 테스트

### 설정

1. iPhone을 Mac에 연결
2. Xcode에서 기기 선택
3. Signing & Capabilities 설정
4. ⌘R 실행

### 권한 테스트

1. 앱 실행 시 권한 요청 팝업 확인
2. "허용" 선택하여 권한 테스트
3. "거부" 선택하여 권한 거부 시나리오 테스트
4. 설정에서 권한 변경 후 앱 재시작하여 변경 감지 확인

---

## 🎓 학습 팁

### 효과적인 학습 방법

1. **이론 먼저**: VIDEO_RECORDING_THEORY.md 정독
2. **코드 실행**: 각 View를 직접 실행해보기
3. **코드 수정**: 값을 바꿔가며 실험
4. **실제 기기**: 실제 기기에서 테스트
5. **가이드 읽기**: VIDEO_RECORDING_GUIDE.md, PERFORMANCE_GUIDE.md

### 실습 아이디어

- 🎥 커스텀 동영상 녹화 UI 만들기
  - 녹화 버튼 디자인 변경
  - 녹화 시간 표시
  - 카메라 전환 버튼

- 🎨 필터 적용하기
  - Core Image 필터 적용
  - 실시간 필터 미리보기
  - 필터 선택 UI

- 📊 성능 분석하기
  - FPS 측정
  - 메모리 사용량 추적
  - 파일 크기 모니터링

---

## ✅ 완료 체크리스트

학습을 마치면 다음을 확인하세요:

### 기본

- [ ] 프로젝트를 성공적으로 실행했다
- [ ] SimpleVideoView에서 미리보기를 확인했다
- [ ] RecordingView에서 동영상을 녹화했다
- [ ] PlaybackView에서 저장된 동영상을 재생했다
- [ ] VideoFlowView에서 전체 플로우를 테스트했다
- [ ] 성능 모니터를 확인했다

### 이론

- [ ] AVFoundation 비디오 녹화 구조를 이해한다
- [ ] AVCaptureMovieFileOutput과 AVCapturePhotoOutput의 차이를 안다
- [ ] 카메라 + 마이크 권한 시스템을 이해한다
- [ ] 세션 구성 플로우를 안다

### 가이드

- [ ] VIDEO_RECORDING_THEORY.md를 읽었다
- [ ] VIDEO_RECORDING_GUIDE.md를 읽었다
- [ ] PERFORMANCE_GUIDE.md를 읽었다
- [ ] 실무 활용 사례를 이해했다

---

## 📖 다음 단계

Day 17을 완료했다면:

1. **복습**: 코드를 다시 읽어보기
2. **응용**: 나만의 동영상 녹화 앱 만들기
3. **공유**: 배운 내용 정리하기
4. **다음**: 동영상 편집 기능 추가

---

## 💬 도움이 필요하신가요?

- 📚 README.md - 전체 가이드
- 📖 VIDEO_RECORDING_THEORY.md - 이론 설명
- 🔧 VIDEO_RECORDING_GUIDE.md - 구현 가이드
- ⚡ PERFORMANCE_GUIDE.md - 성능 측정

---

**즐거운 학습 되세요! 🎥**

