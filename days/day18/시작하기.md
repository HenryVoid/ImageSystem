# Day 18 시작하기

> AVAsset 썸네일 생성 학습을 위한 빠른 시작 가이드

---

## 🎯 오늘의 학습 목표

동영상에서 특정 타임의 이미지를 추출해 썸네일을 자동 생성하는 기능을 학습합니다.

---

## ⚡ 빠른 시작 (5분)

### 1단계: 프로젝트 열기

```bash
cd day18
open day18.xcodeproj
```

### 2단계: 앱 실행

```
⌘R (Run)
```

**참고**: 샘플 비디오가 없으면 실제 동영상 파일을 사용해야 합니다.

---

## 📚 학습 순서

### 1️⃣ 이론 학습 (30분)

**AVASSET_THEORY.md** 읽기
- AVAssetImageGenerator 기본 개념
- CMTime 이해하기
- 썸네일 생성 원리

**THUMBNAIL_GUIDE.md** 읽기
- 단계별 구현 가이드
- 비동기 처리 패턴
- 배치 처리 방법

**PERFORMANCE_GUIDE.md** 읽기
- 성능 최적화 방법
- 캐싱 전략
- 메모리 관리

### 2️⃣ 기본 실습 (40분)

**SimpleThumbnailView**
- 동영상 선택
- 특정 시간 입력
- 썸네일 생성 및 표시

**BatchThumbnailView**
- 여러 타임라인에서 썸네일 생성
- 진행률 표시
- 그리드 레이아웃

### 3️⃣ 실전 응용 (30분)

**ThumbnailGalleryView**
- 여러 동영상의 썸네일 관리
- 캐싱 시스템 활용
- 성능 모니터링

### 4️⃣ 가이드 읽기 (20분)

```
AVASSET_THEORY.md          - 이론 설명
THUMBNAIL_GUIDE.md         - 구현 가이드
PERFORMANCE_GUIDE.md       - 성능 최적화
```

**총 학습 시간: 약 2시간**

---

## 🔑 핵심 코드

### 기본 썸네일 생성

```swift
let asset = AVAsset(url: videoURL)
let generator = AVAssetImageGenerator(asset: asset)
generator.appliesPreferredTrackTransform = true
generator.maximumSize = CGSize(width: 200, height: 200)

let time = CMTime(seconds: 5.0, preferredTimescale: 600)
let cgImage = try await generator.image(at: time).image
let thumbnail = UIImage(cgImage: cgImage)
```

### 비동기 처리

```swift
Task {
    let thumbnail = try await ThumbnailGenerator.generateThumbnail(
        from: videoURL,
        at: 5.0
    )
    await MainActor.run {
        self.thumbnail = thumbnail
    }
}
```

### 배치 처리

```swift
let times = [1.0, 5.0, 10.0, 15.0]
let thumbnails = try await ThumbnailGenerator.generateThumbnails(
    from: videoURL,
    at: times,
    progressHandler: { progress in
        print("진행률: \(progress * 100)%")
    }
)
```

### 캐싱 활용

```swift
let cacheKey = ThumbnailCacheKey(videoURL: url, time: 5.0)

// 캐시에서 가져오기
if let cached = ThumbnailCache.shared.getThumbnail(for: cacheKey) {
    thumbnail = cached
} else {
    // 생성 후 캐시에 저장
    let thumbnail = try await ThumbnailGenerator.generateThumbnail(...)
    ThumbnailCache.shared.storeThumbnail(thumbnail, for: cacheKey)
}
```

---

## ⚠️ 주의사항

### 동영상 파일 형식

지원되는 형식:
- MP4 (.mp4)
- QuickTime (.mov)
- MPEG-4 (.m4v)

### 시간 정확도

- `preferredTimescale`을 600으로 설정하면 1/600초 단위로 정확하게 지정 가능
- `requestedTimeToleranceBefore/After`로 허용 오차 설정 가능

### 메모리 관리

- 큰 동영상에서 썸네일 생성 시 메모리 사용량 주의
- `maximumSize`로 썸네일 크기 제한 권장
- 캐싱 사용 시 메모리 캐시 크기 제한 설정

### 비동기 처리

- 썸네일 생성은 시간이 걸릴 수 있으므로 반드시 비동기 처리
- UI 업데이트는 `MainActor`에서 수행

---

## 🐛 문제 해결

### "유효하지 않은 동영상 파일입니다" 오류

**원인**: 지원하지 않는 형식이거나 손상된 파일

**해결**:
1. 파일 형식 확인 (MP4, MOV, M4V 권장)
2. 다른 동영상 파일로 테스트
3. 파일이 손상되지 않았는지 확인

### "유효하지 않은 시간입니다" 오류

**원인**: 동영상 길이를 초과하는 시간 지정

**해결**:
1. 동영상 길이 확인: `ThumbnailGenerator.getDuration(from:)`
2. 유효한 시간 범위 내에서 지정
3. 시간 입력값 검증

### "이미지 생성에 실패했습니다" 오류

**원인**: 디코딩 실패 또는 메모리 부족

**해결**:
1. `maximumSize`로 썸네일 크기 제한
2. 메모리 사용량 확인
3. 다른 시간으로 재시도

### 썸네일 생성이 느립니다

**원인**: 큰 동영상 파일 또는 높은 해상도

**해결**:
1. `maximumSize` 설정으로 크기 제한
2. `requestedTimeToleranceBefore/After` 설정으로 정확도 조정
3. 캐싱 활용하여 재생성 방지

---

## 📱 테스트 방법

### 샘플 비디오 준비

1. iPhone에서 동영상 촬영 또는 다운로드
2. Xcode 프로젝트에 추가 (선택)
3. 또는 실제 기기에서 파일 선택

### 성능 측정

1. **SimpleThumbnailView**에서 생성 시간 확인
2. **BatchThumbnailView**에서 배치 처리 시간 확인
3. **ThumbnailGalleryView**에서 캐시 효과 확인

### 캐시 테스트

1. 썸네일 생성 후 캐시 정보 확인
2. 같은 동영상/시간으로 재생성 시 즉시 표시되는지 확인
3. 캐시 비우기 후 재생성 시간 비교

---

## 🎓 학습 팁

### 효과적인 학습 방법

1. **이론 먼저**: AVASSET_THEORY.md 정독
2. **코드 실행**: 각 View를 직접 실행해보기
3. **값 변경**: 시간, 크기 등을 바꿔가며 실험
4. **성능 측정**: 생성 시간과 메모리 사용량 확인
5. **가이드 읽기**: THUMBNAIL_GUIDE.md, PERFORMANCE_GUIDE.md

### 실습 아이디어

- 🎥 동영상 타임라인 썸네일 만들기
  - 여러 시간의 썸네일을 한 줄로 표시
  - 썸네일 클릭 시 해당 시간으로 이동

- 🎨 썸네일 필터 적용하기
  - Core Image 필터 적용
  - 밝기, 대비 조정

- 📊 성능 분석하기
  - 생성 시간 측정
  - 메모리 사용량 추적
  - 캐시 히트율 계산

---

## ✅ 완료 체크리스트

학습을 마치면 다음을 확인하세요:

### 기본

- [ ] 프로젝트를 성공적으로 실행했다
- [ ] SimpleThumbnailView에서 썸네일을 생성했다
- [ ] BatchThumbnailView에서 배치 썸네일을 생성했다
- [ ] ThumbnailGalleryView에서 캐싱을 확인했다

### 이론

- [ ] AVAssetImageGenerator 구조를 이해한다
- [ ] CMTime의 개념을 안다
- [ ] 비동기 처리 패턴을 이해한다
- [ ] 캐싱 전략을 안다

### 가이드

- [ ] AVASSET_THEORY.md를 읽었다
- [ ] THUMBNAIL_GUIDE.md를 읽었다
- [ ] PERFORMANCE_GUIDE.md를 읽었다
- [ ] 실무 활용 사례를 이해했다

---

## 📖 다음 단계

Day 18을 완료했다면:

1. **복습**: 코드를 다시 읽어보기
2. **응용**: 나만의 썸네일 생성 앱 만들기
3. **공유**: 배운 내용 정리하기
4. **다음**: 동영상 편집 기능 추가

---

## 💬 도움이 필요하신가요?

- 📚 README.md - 전체 가이드
- 📖 AVASSET_THEORY.md - 이론 설명
- 🔧 THUMBNAIL_GUIDE.md - 구현 가이드
- ⚡ PERFORMANCE_GUIDE.md - 성능 최적화

---

**즐거운 학습 되세요! 🎬**

